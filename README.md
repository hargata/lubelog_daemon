# LubeLogger Daemon

## What

This is a sidecar service for LubeLogger that allows for real-time integration with notification systems such as Ntfy, Gotify, and Discord Webhooks.

## How it works

<img width="793" height="311" alt="image" src="https://github.com/user-attachments/assets/dce1c1f7-408d-42e5-8b24-51ecdc62ad66" />

This project essentially retrieves reminders from your LubeLogger instance and compares those reminders to a cached copy(stored in memory), if there are changes detected(i.e.: a reminder has moved from Not Urgent to Urgent), then it will fire off a notification payload to the integrated services.

Additionally, it can also forward the webhook payload to multiple additional webhook ingestions, so this doesn't entirely replace your existing webhook integrations.

For date-based reminders, this service comes with a background taskworker that will check and send out reminders at a fixed time every day.

## Security(or lack thereof)

This should run within a private network where it can access your LubeLogger instance as well as any notification integrations you have configured, there are no security features for this service.

## Getting Started

1. Clone the [docker-compose.yml](https://github.com/hargata/lubelog_daemon/blob/main/docker-compose.yml) file
2. Open a terminal and run
```
docker compose pull
docker compose up
```
3. The daemon service will start listening at `localhost:40750` by default, you can change this in `docker-compose.yml`
4. Check the sample configurations in [SampleConfigs](https://github.com/hargata/lubelog_daemon/tree/main/SampleConfigs)
5. Find the config file for the integration you want and copy the content
6. Replace the placeholders with your data
7. Make a POST request to `http://localhost:40750/webhook/config` with the content as the JSON body
8. Restart the service
9. Configure your LubeLogger instance so that webhook payload are sent to the daemon service
10. Send a test notification to verify that everything is working

### Configuration
| Key                 | Description                                                                                 | Example Value                                     |
|---------------------|---------------------------------------------------------------------------------------------|---------------------------------------------------|
| instanceUrl         | URL to LubeLogger                                                                           | "https://demo.lubelogger.com"                     |
| apiKey              | An API Key generated by the Root User                                                       | "bed6bd6b39904a94ac5368fcfa310aae"                |
| hourToCheck         | UTC Time of day to check for date-based reminders                                           | "5" means that it will check at 5 AM UTC everyday |
| checkDateReminders  | Whether the service should check for date-based reminders                                   | "true" or "false"                                 |
| daysToCache         | Number of days the reminders should be cached so they don't remind the users multiple times | "1" (Absolute Values Only)                        |
| urgenciesTracked    | List of urgencies the service should track when reminders move into these statuses          | "noturgent", "urgent", "veryurgent", "pastdue"    |
| webHookForwards     | List of webhooks to forward the original webhook payload to                                 | "webhooksite1", "webhooksite2"                    |
| notificationConfigs | List of notification configs                                                                | See "SampleConfigs"                               |
